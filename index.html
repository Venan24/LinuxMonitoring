<!DOCTYPE html>
<!--
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.3.6
Version: 4.5.4
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest(the above link) in order to legally use the theme for your project.
-->
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<head>
  <meta charset="utf-8" />
  <title>Server Monitoring</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="" name="description" />
  <meta content="" name="author" />
  <!-- BEGIN GLOBAL MANDATORY STYLES -->
  <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link href="css/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
  <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />

  <link href="css/components-rounded.min.css" rel="stylesheet" id="style_components" type="text/css" />
  <!-- END THEME GLOBAL STYLES -->
  <!-- BEGIN PAGE LEVEL STYLES -->
  <link href="css/profile.min.css" rel="stylesheet" type="text/css" />
  <!-- END PAGE LEVEL STYLES -->
  <!-- BEGIN THEME LAYOUT STYLES -->
  <link href="css/layout.min.css" rel="stylesheet" type="text/css" />
  <link href="css/themes/blue.min.css" rel="stylesheet" type="text/css" id="style_color" />
  <link href="css/custom.min.css" rel="stylesheet" type="text/css" />
  <link href="bower_components/bootstrap-sweetalert/dist/sweetalert.css" rel="stylesheet" type="text/css" />
  <!-- END THEME LAYOUT STYLES -->
  <link rel="shortcut icon" href="favicon.ico" /> </head>
<!-- END HEAD -->

<body class="page-header-fixed page-container-bg-solid page-content-white" style="background-color: #eef1f5; display: none;">
  <!-- BEGIN HEADER -->
  <div class="page-header navbar navbar-fixed-top">
    <!-- BEGIN HEADER INNER -->
    <div class="page-header-inner ">
      <!-- BEGIN LOGO -->
      <div class="page-logo">
        <a href="index.html"><img src="img/logo.png" alt="logo" class="logo-default" /> </a>
      </div>
      <!-- END LOGO -->
      <!-- BEGIN RESPONSIVE MENU TOGGLER -->
      <a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse"> </a>
      <!-- END RESPONSIVE MENU TOGGLER -->
      <!-- BEGIN TOP NAVIGATION MENU -->
      <div class="top-menu">
        <ul class="nav navbar-nav pull-right">
          <li class="dropdown dropdown-user">
            <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                                <img class="profile-image img-circle" />
                                <span class="profile-name username username-hide-on-mobile">Venan Osmic </span>
                                <i class="fa fa-angle-down"></i>
                            </a>
            <ul class="dropdown-menu dropdown-menu-default">
              <li>
                <a target="_blank" href="https://myaccount.google.com/">
                                        <i class="icon-user"></i> My Profile </a>
              </li>
              <li>
                <a href="javascript:;create_new_server();">
                                        <i class="icon-plus"></i> Add New Machine </a>
              </li>
            </ul>
          </li>
          <!-- END USER LOGIN DROPDOWN -->
          <!-- BEGIN QUICK SIDEBAR TOGGLER -->
          <!-- DOC: Apply "dropdown-dark" class after below "dropdown-extended" to change the dropdown styte -->
          <li class="dropdown dropdown-quick-sidebar-toggler">
            <a href="javascript:;Login.logout()" class="dropdown-toggle">
                                <i class="icon-logout"></i>
                            </a>
          </li>
          <!-- END QUICK SIDEBAR TOGGLER -->
        </ul>
      </div>
      <!-- END TOP NAVIGATION MENU -->
    </div>
    <!-- END HEADER INNER -->
  </div>
  <!-- END HEADER -->
  <!-- BEGIN HEADER & CONTENT DIVIDER -->
  <div class="clearfix"> </div>
  <!-- END HEADER & CONTENT DIVIDER -->
  <!-- BEGIN CONTAINER -->
  <div class="page-container">

    <!-- BEGIN CONTENT -->
    <div class="page-content-wrapper">
      <!-- BEGIN CONTENT BODY -->
      <div class="page-content" style="margin-left: 0px;">
        <!-- BEGIN PAGE HEADER-->
        <!-- END PAGE HEADER-->
        <div class="row">
          <div class="col-md-12">
            <!-- BEGIN PROFILE SIDEBAR -->
            <div class="profile-sidebar">
              <!-- PORTLET MAIN -->
              <div class="portlet light profile-sidebar-portlet ">
                <!-- SIDEBAR USERPIC -->
                <div class="profile-userpic">
                  <img class="profile-image img-responsive" alt=""> </div>
                <!-- END SIDEBAR USERPIC -->
                <!-- SIDEBAR USER TITLE -->
                <div class="profile-usertitle">
                  <div class="profile-name profile-usertitle-name"> Venan Osmic </div>
                  <div id="profile-email" class="profile-usertitle-name"> venanosmic24@gmail.com </div>
                </div>
                <!-- END SIDEBAR USER TITLE -->

                <!-- SIDEBAR MENU -->
                <div class="profile-usermenu">
                  <ul class="nav">
                    <li class="active">
                      <a href="index.html" style="font-size: 14px;">
                        <i class="fas fa-tachometer-alt"></i> My Dashboard </a>
                    </li>
                    <li>
                      <a href="javascript:;create_new_server();" style="font-size: 14px;">
                        <i class="fas fa-plus-circle"></i> Create New Machine </a>
                    </li>
                    <li>
                      <a href="javascript:;Login.logout()" style="font-size: 14px;">
                        <i class="fas fa-sign-out-alt"></i> Log Out </a>
                    </li>
                  </ul>
                </div>
                <!-- END MENU -->
              </div>
              <!-- END PORTLET MAIN -->

            </div>
            <!-- END BEGIN PROFILE SIDEBAR -->
            <!-- BEGIN PROFILE CONTENT -->
            <div class="profile-content">
              <div class="row">
                <div class="col-md-12">
                  <div class="portlet light ">
                    <div class="portlet-title tabbable-line">
                      <div class="caption caption-md">
                        <i class="icon-globe theme-font hide"></i>
                        <span class="caption-subject font-blue-madison bold uppercase">Servers assigned to: <span style="color:#BD0C0C; font-size: 20px; " class="profile-name" > First name Last name </span></span>
                      </div>
                    </div>

                    <div class="row list-separated profile-stat">
                      <div class="col-md-12 ">
                        <div class="uppercase profile-stat-title" id="serversnumber"></div>
                        <div class="uppercase profile-stat-text" id="serverstext"></div>
                      </div>
                    </div>

                    <div id="main_tables" class="portlet-body" style="display:none;">
                      <div class="tab-content">
                        <div class="panel-group">
                          <div class="panel panel-primary">
                            <div class="panel-heading">All active servers</div>
                            <div class="panel-body">
                              <table class="table" id="all_servers">
                                <thead>
                                  <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Server Name</th>
                                    <th scope="col">OS</th>
                                    <th scope="col">OS Version</th>
                                    <th scope="col">IP</th>
                                    <th scope="col">Action</th>
                                  </tr>
                                </thead>
                              </table>

                            </div>
                          </div>
                        </div>

                        <div class="row list-separated profile-stat">
                          <div class="col-md-12 ">
                            <div class="panel panel-danger">
                              <div class="panel-heading">All inactive servers</div>
                              <div class="panel-body">
                                <table class="table" id="all_inactive_servers">
                                  <thead>
                                    <tr>
                                      <th scope="col">#</th>
                                      <th scope="col">Server Name</th>
                                      <th scope="col">Action</th>
                                    </tr>
                                  </thead>
                                </table>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- END PROFILE CONTENT -->
          </div>
        </div>
      </div>
      <!-- END CONTENT BODY -->
    </div>
    <!-- END CONTENT -->
  </div>
  <!-- END CONTAINER -->
  <!--[if lt IE 9]>
<script src="../assets/global/plugins/respond.min.js"></script>
<script src="../assets/global/plugins/excanvas.min.js"></script>
<![endif]-->

  <!-- BEGIN CORE PLUGINS -->
  <script src="js/jquery.min.js" type="text/javascript"></script>
  <script src="js/bootstrap.min.js" type="text/javascript"></script>

  <script src="js/utils.js" type="text/javascript"></script>
  <script src="js/login.js" type="text/javascript"></script>
  <script src="bower_components/bootstrap-sweetalert/dist/sweetalert.js"></script>
</body>

<script type="text/javascript">
  //Login Check
  var token = Utils.get_from_localstorage('auth');
  if (!Utils.get_from_localstorage('user')) {
    window.location = "/login.html";
  } else {
    $.get("rest/v1/provjeritoken",{authtoken: token}).done(function(data) {
      if (data.Authorized != false) {
        Utils.check_for_hacker();
        $('.profile-image').attr('src', Utils.get_from_localstorage('user').image);
        $('.profile-name').html(Utils.get_from_localstorage('user').name);
        $('#profile-email').html(Utils.get_from_localstorage('user').email);
        $('body').show();

        //GET DATA
        get_user_servers_by_number();
      } else {
        Utils.incorrect_auth();
      }
    });
  }

  //Get all servers that running script (at least once)
  function get_user_servers_list() {
    $.get("rest/v1/server", {authtoken: token}).done(function(data) {
      //console.log(data);
      if (data.Authorized == false) {
        Utils.incorrect_auth();
      } else {
        $('#all_servers').html("");
        $('#all_servers').append("<thead><tr><th scope='col'>#</th><th scope='col'>Server Name</th><th scope='col'>OS</th><th scope='col'>OS Version</th><th scope='col'>IP</th><th scope='col'>Actions</th></tr></thead>");
        $.each(data, function(index, item) {
          $('#all_servers').append('<tr><th scope="row">' + item.server_id + '</th>' + '<td style="cursor:pointer;" id="' + item.auth_code + '" onClick="return_auth(this.id)">' + item.server_name + '</td>' + '<td>' + item.os_name + '</td>' +
            '<td>' + item.os_version +
            '</td>' + '<td>' + item.external_ip +
            '</td><td><a id="' + item.auth_code + '" href="#" onClick="change_sever_name(this.id)" class="btn btn-primary"><span class="icon-wrench"></span> Name</a><a href="graphstats.html?auth=' + item.auth_code + '&servername=' + item
            .server_name +
            '" class="btn btn-success"><span class="icon-graph"></span> Stats</a><a id="' + item.auth_code +
            '" href="#" onClick="remove_selected_server(this.id)" class="btn btn-danger"><span class="icon-trash"></span></a><a href="/rest/v1/download/'+item.auth_code+'" class="btn btn-default"><span class="icon-cloud-download"></span> Download</a></td></tr>'
          );
        });
      }
    }).fail(function(error) {
      console.log(error.responseJSON.error);
    });
  }

  //Get all inactive servers
  function get_user_servers_list_inactive() {
    $.get("rest/v1/serverinactive", {authtoken: token}).done(function(data) {
      //console.log(data);
      if (data.Authorized == false) {
        Utils.incorrect_auth();
      } else {
        $('#all_inactive_servers').html("");
        $('#all_inactive_servers').append("<thead><tr><th scope='col'>#</th><th scope='col'>Server Name</th><th scope='col'>Actions</th></tr></thead>");
        $.each(data, function(index, item) {
          $('#all_inactive_servers').append('<tr><th scope="row">' + item.server_id + '</th>' + '<td style="cursor:pointer;" id="' + item.auth_code + '" onClick="return_auth(this.id)">' + item.server_name + '</td>' +
            '</td><td><a id="' + item.auth_code + '" href="#" onClick="change_sever_name(this.id)" class="btn btn-primary"><span class="icon-wrench"></span> Change Name</a><a id="' + item.auth_code +
            '" href="#" onClick="remove_selected_server(this.id)" class="btn btn-danger"><span class="icon-trash"></span> Remove</a><a href="/rest/v1/download/'+item.auth_code+'" class="btn btn-default"><span class="icon-cloud-download"></span> Download Monitoring Script</a></td></tr>'
          );
        });
      }
    }).fail(function(error) {
      console.log(error.responseJSON.error);
    });
  }

  //Get number of all servers that belong to user
  function get_user_servers_by_number() {
    $.get("rest/v1/serverbynum", {authtoken: token}).done(function(data) {
      if (data.Authorized == false) {
        Utils.incorrect_auth();
      } else {
        if (data.Servers == 0){
          $('#main_tables').hide();
          $('#serverstext').html("");
          $('#serversnumber').html("");
          $('#serversnumber').html("<p>Looks like you do not have any machines registered.<br><b><a href='javascript:;create_new_server();'>CLICK HERE</a></b> to create new one.</p>");
        }else{
          $('#serversnumber').html("");
          $('#serversnumber').append(data.Servers);
          $('#serverstext').html("Servers");
          $('#main_tables').show();
          get_user_servers_list();
          get_user_servers_list_inactive()
        }
      }
    }).fail(function(error) {
      console.log(error.responseJSON.error);
    });
  }

  //Create new server
  function create_new_server() {
    swal({
      title: "Add New Machine:",
      text: "Enter new server's name:",
      type: "input",
      showCancelButton: true,
      closeOnConfirm: false,
      inputPlaceholder: "Write name"
    }, function(inputValue) {
      if (inputValue === false) return false;
      if (inputValue === "") {
        swal.showInputError("You need to write something!");
        return false
      }
      $.get("rest/v1/crateserver", {authtoken: token, newname: inputValue}).done(function(data) {
        //console.log(data);
        if (data.Authorized != false) {
          Utils.downoload_file("rest/v1/download/" + data, "LinuxMonitoring.py");
          swal({
              title: "Successfully Created",
              text: "To start monitoring, run downloaded file with: sudo python2 ServerMonitoring.py",
              type: "success",
              confirmButtonClass: "btn-info",
              confirmButtonText: "Close",
              closeOnConfirm: true
            },
            function() {
              get_user_servers_by_number();
            });
        } else {
          swal("Error!", "Error in: " + data, "error");
        }
      }).fail(function(error) {
        console.log(error);
      });
    });
  }

  //Remove selected server
  function remove_selected_server(clickedServerAuth) {
    swal({
        title: "Are you sure?",
        text: "Your will not be able to recover this server!",
        type: "warning",
        showCancelButton: true,
        confirmButtonClass: "btn-danger",
        confirmButtonText: "Yes, delete it!",
        closeOnConfirm: false
      },
      function() {
        $.get("rest/v1/remove_server",{authtoken: token, serverauth: clickedServerAuth}).done(function(data) {
          if (data.Authorized != false) {
            swal({
              title: "Deleted!",
              text: "Your server has been deleted",
              type: "success",
              timer: 1000,
              showConfirmButton: false
            });
            window.setTimeout(function() {
              get_user_servers_list();
              get_user_servers_list_inactive()
              get_user_servers_by_number();
            }, 1000);
          } else {
            swal("Error!", "Error in: " + data, "error");
          }
        }).fail(function(error) {
          console.log(error);
        });
      });
  }

  //Return auth code when user click on server name and make copy to clipboard
  function return_auth(clickeditem) {
    swal({
        title: "Authentication Code:",
        text: "Your auth code for python scrypt is: " + clickeditem,
        type: "info",
        showCancelButton: false,
        confirmButtonClass: "btn-success",
        confirmButtonText: "Copy To Clipboard!",
        closeOnConfirm: false,
        allowOutsideClick: true
      },
      function() {
        var dummy = document.createElement("input");
        document.body.appendChild(dummy);
        dummy.setAttribute("id", "dummy_id");
        dummy.setAttribute('value', clickeditem)
        dummy.select();
        document.execCommand("copy");
        document.body.removeChild(dummy);
        swal({
          title: "Copyed!",
          text: "Your auth code has been copyed",
          type: "success",
          timer: 1500,
          showConfirmButton: false
        });
      });
  }

  //Change server name
  function change_sever_name(clickedServerAuth) {
    swal({
      title: "Change Server Name:",
      text: "Enter new server's name:",
      type: "input",
      showCancelButton: true,
      closeOnConfirm: false,
      inputPlaceholder: "Write new server name"
    }, function(inputValue) {
      if (inputValue === false) return false;
      if (inputValue === "") {
        swal.showInputError("You need to write something!");
        return false
      }

      $.get("rest/v1/change_sever_name",{authtoken: token, serverauth: clickedServerAuth, newname: inputValue}).done(function(data) {
        if (data.Authorized != false) {
          swal({
            title: "Success!",
            text: "Name chaged",
            type: "success",
            timer: 1000,
            showConfirmButton: false
          });
          window.setTimeout(function() {
            get_user_servers_list();
            get_user_servers_list_inactive()
          }, 2500);
        } else {
          swal("Error!", "Error in: " + data, "error");
        }
      }).fail(function(error) {
        console.log(error);
      });
    });
  }
</script>

</html>
