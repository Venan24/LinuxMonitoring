<!DOCTYPE html>
<!--
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.3.6
Version: 4.5.4
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest(the above link) in order to legally use the theme for your project.
-->
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<head>
  <meta charset="utf-8" />
  <title>Server Monitoring</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="" name="description" />
  <meta content="" name="author" />
  <!-- BEGIN GLOBAL MANDATORY STYLES -->
  <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
  <link href="css/font-awesome.min.css" rel="stylesheet" type="text/css" />
  <link href="css/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
  <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />

  <link href="css/components-rounded.min.css" rel="stylesheet" id="style_components" type="text/css" />
  <!-- END THEME GLOBAL STYLES -->
  <!-- BEGIN PAGE LEVEL STYLES -->
  <link href="css/profile.min.css" rel="stylesheet" type="text/css" />
  <!-- END PAGE LEVEL STYLES -->
  <!-- BEGIN THEME LAYOUT STYLES -->
  <link href="css/layout.min.css" rel="stylesheet" type="text/css" />
  <link href="css/themes/blue.min.css" rel="stylesheet" type="text/css" id="style_color" />
  <link href="css/custom.min.css" rel="stylesheet" type="text/css" />
  <link href="bower_components/bootstrap-sweetalert/dist/sweetalert.css" rel="stylesheet" type="text/css" />
  <!-- END THEME LAYOUT STYLES -->
</head>

<!--  <style>
			.chart-container {
				width: 100%;
				height: auto;
			}
		</style>-->
<!-- END HEAD -->

<body class="page-header-fixed page-container-bg-solid page-content-white" style="background-color: #eef1f5; display: none;">
  <!-- BEGIN HEADER -->
  <div class="page-header navbar navbar-fixed-top">
    <!-- BEGIN HEADER INNER -->
    <div class="page-header-inner ">
      <!-- BEGIN LOGO -->
      <div class="page-logo">
        <a href="index.html"><img src="img/logo.png" alt="logo" class="logo-default" /> </a>
      </div>
      <!-- END LOGO -->
      <!-- BEGIN RESPONSIVE MENU TOGGLER -->
      <a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse"> </a>
      <!-- END RESPONSIVE MENU TOGGLER -->
      <!-- BEGIN TOP NAVIGATION MENU -->
      <div class="top-menu">
        <ul class="nav navbar-nav pull-right">
          <li class="dropdown dropdown-user">
            <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                                <img class="profile-image img-circle" />
                                <span class="profile-name username username-hide-on-mobile">Venan Osmic </span>
                                <i class="fa fa-angle-down"></i>
                            </a>
            <ul class="dropdown-menu dropdown-menu-default">
              <li>
                <a target="_blank" href="https://myaccount.google.com/">
                                        <i class="icon-user"></i> My Profile </a>
              </li>
              <li>
                <a href="javascript:;create_new_server();">
                                        <i class="icon-plus"></i> Add New Machine </a>
              </li>
            </ul>
          </li>
          <!-- END USER LOGIN DROPDOWN -->
          <!-- BEGIN QUICK SIDEBAR TOGGLER -->
          <!-- DOC: Apply "dropdown-dark" class after below "dropdown-extended" to change the dropdown styte -->
          <li class="dropdown dropdown-quick-sidebar-toggler">
            <a href="javascript:;Login.logout()" class="dropdown-toggle">
                                <i class="icon-logout"></i>
                            </a>
          </li>
          <!-- END QUICK SIDEBAR TOGGLER -->
        </ul>
      </div>
      <!-- END TOP NAVIGATION MENU -->
    </div>
    <!-- END HEADER INNER -->
  </div>
  <!-- END HEADER -->
  <!-- BEGIN HEADER & CONTENT DIVIDER -->
  <div class="clearfix"> </div>
  <!-- END HEADER & CONTENT DIVIDER -->
  <!-- BEGIN CONTAINER -->
  <div class="page-container">

    <!-- BEGIN CONTENT -->
    <div class="page-content-wrapper">
      <!-- BEGIN CONTENT BODY -->
      <div class="page-content" style="margin-left: 0px;">
        <!-- BEGIN PAGE HEADER-->
        <!-- END PAGE HEADER-->
        <div class="row">
          <div class="col-md-12">
            <!-- BEGIN PROFILE CONTENT -->
            <div class="profile-content">
              <div class="row">
                <div class="col-md-12">
                  <div class="portlet light ">
                    <div class="portlet-title tabbable-line">
                      <div class="caption caption-md">
                        <i class="icon-globe theme-font hide"></i>
                        <span class="caption-subject font-blue-madison bold uppercase">Data for: <span style="color:#BD0C0C; font-size: 20px;" id="servername"></span> Last 12 recoreds ( &cong; 1min) </span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-sm-12 col-lg-4">
                        <div class="panel panel-primary">
                          <div class="panel-heading">Machine Info</div>
                          <div class="panel-body">
                            <div id="serverinfo"></div>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-12 col-lg-4">
                        <div class="panel panel-primary">
                          <div class="panel-heading">CPU Stats</div>
                          <div class="panel-body">
                            <center>
                              <div class="chart-container">
                                <canvas id="cpugraph"></canvas>
                              </div>
                            </center>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-12 col-lg-4">
                        <div class="panel panel-primary">
                          <div class="panel-heading">RAM Stats</div>
                          <div class="panel-body">
                            <center>
                              <div class="chart-container">
                                <canvas id="ramgraph"></canvas>
                              </div>
                            </center>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-sm-12 col-lg-4">
                        <div class="panel panel-primary">
                          <div class="panel-heading">SWAP Stats</div>
                          <div class="panel-body">
                            <center>
                              <div class="chart-container">
                                <canvas id="swapgraph"></canvas>
                              </div>
                            </center>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-12 col-lg-4">
                        <div class="panel panel-primary">
                          <div class="panel-heading">HDD Stats</div>
                          <div class="panel-body">
                            <center>
                              <div class="chart-container">
                                <canvas id="hddgraph"></canvas>
                              </div>
                            </center>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-12 col-lg-4">
                        <div class="panel panel-primary">
                          <div class="panel-heading">PID Stats</div>
                          <div class="panel-body">
                            <center>
                              <div class="chart-container">
                                <canvas id="pidgraph"></canvas>
                              </div>
                            </center>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- END PROFILE CONTENT -->
          </div>
        </div>
      </div>
      <!-- END CONTENT BODY -->
    </div>
    <!-- END CONTENT -->
  </div>
  <!-- END CONTAINER -->
  <!--[if lt IE 9]>
<script src="../assets/global/plugins/respond.min.js"></script>
<script src="../assets/global/plugins/excanvas.min.js"></script>
<![endif]-->
  <!-- BEGIN CORE PLUGINS -->
  <script src="js/jquery.min.js" type="text/javascript"></script>
  <script src="js/bootstrap.min.js" type="text/javascript"></script>

  <script src="js/utils.js" type="text/javascript"></script>
  <script src="js/login.js" type="text/javascript"></script>
  <script src="bower_components/bootstrap-sweetalert/dist/sweetalert.js"></script>
  <script type="text/javascript" src="js/Chart.min.js"></script>
</body>

<script type="text/javascript">
  var token = Utils.get_from_localstorage('auth');
  if (!Utils.get_from_localstorage('user')) {
    window.location = "/login.html";
  } else {
    $.get("rest/v1/provjeritoken/" + token).done(function(data) {
      if (data.Authorized != false) {
        Utils.check_for_hacker();
        $('.profile-image').attr('src', Utils.get_from_localstorage('user').image);
        $('.profile-name').html(Utils.get_from_localstorage('user').name);
        $('#profile-email').html(Utils.get_from_localstorage('user').email);
        $('body').show();

        //GET DATA
        get_data_for_opened_server();
      } else {
        Utils.incorrect_auth();
      }
    });
  }

  function create_new_server() {
    swal({
      title: "Add New Machine:",
      text: "Enter new server's name:",
      type: "input",
      showCancelButton: true,
      closeOnConfirm: false,
      inputPlaceholder: "Write name"
    }, function(inputValue) {
      if (inputValue === false) return false;
      if (inputValue === "") {
        swal.showInputError("You need to write something!");
        return false
      }
      $.get("rest/v1/crateserver/" + inputValue + "/" + token).done(function(data) {
        //console.log(data);
        if (data.Authorized != false) {
          swal({
            title: "Authentification Code: " + data,
            type: "info",
            confirmButtonClass: "btn-info",
            confirmButtonText: "Close",
            closeOnConfirm: true
          });
        } else {
          swal("Error!", "Error in: " + data, "error");
        }
      }).fail(function(error) {
        console.log(error);
      });
    });
  }

  function get_data_for_opened_server() {
    var current_url = window.location.href;
    var url = new URL(current_url);
    var auth = url.searchParams.get("auth");
    var server_name = url.searchParams.get("servername");
    $('#servername').append(server_name);


    $.get("rest/v1/getmachineinfo/" + auth + "/" + token).done(function(data) {
      if (data.Authorized != false) {
        $.each(data, function(index, item) {
          $('#serverinfo').append("<table class='table'><tbody><tr><th scope='row'>OS (version): </th><td>"+item.os_name+" ("+item.os_version+")</td></tr><tr><th scope='row'>CPU: </th><td>"+item.cpu_model+"</td></tr><tr><th scope='row'>CPU Architecture </th><td>"+item.cpu_architecture+"</td></tr><tr><th scope='row'>CPU Cores (Threads): </th><td>"+item.cpu_cores+" ("+item.cpu_threads+")</td></tr><tr><th scope='row'>Hostname</th><td>"+item.hostname+"</td></tr><tr><th scope='row'>IP Internale (Extrernal): </th><td>"+item.internal_ip+" ("+item.external_ip+")</td></tr></tbody></table>");
        });
      } else {
        Utils.incorrect_auth();
      }
    });

    $.get("rest/v1/getgraph/" + auth + "/" + token).done(function(data) {
      //console.log(data);
      if (data.Authorized != false) {
        var timesubmited = [];
        var cpu_percentage = [];
        var ram_used = [];
        var ram_shared = [];
        var ram_available = [];
        var ram_buff = [];
        var swap_total = [];
        var swap_used = [];
        var total_hdd = [];
        var swap_free = [];
        var used_hdd = [];
        var available_hdd = [];
        var pid_running = [];
        var ram_total = []

        for (var i in data) {
          timesubmited.push(data[i].timesubmited);
          cpu_percentage.push(data[i].cpu_percentage);
          ram_used.push(data[i].ram_used);
          ram_shared.push(data[i].ram_shared);
          ram_available.push(data[i].ram_available);
          ram_buff.push(data[i].ram_buff);

          swap_total.push(data[i].swap_total);
          swap_used.push(data[i].swap_used);
          swap_free.push(data[i].swap_free);
          total_hdd.push(data[i].total_hdd);
          used_hdd.push(data[i].used_hdd);
          available_hdd.push(data[i].available_hdd);
          pid_running.push(data[i].pid_running);
          ram_total.push(data[i].ram_total)
        }

        var chartdata = {
          labels: timesubmited,
          datasets: [{
              label: "CPU Percentage",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(211, 72, 54, 0.75)",
              borderColor: "rgba(211, 72, 54, 1)",
              pointHoverBackgroundColor: "rgba(211, 72, 54, 1)",
              pointHoverBorderColor: "rgba(211, 72, 54, 1)",
              borderWidth: 5,
              data: cpu_percentage
            },
            {
              label: "RAM Used",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(29, 202, 255, 0.75)",
              borderColor: "rgba(29, 202, 255, 1)",
              pointHoverBackgroundColor: "rgba(29, 202, 255, 1)",
              pointHoverBorderColor: "rgba(29, 202, 255, 1)",
              borderWidth: 5,
              data: ram_used
            },
            {
              label: "RAM Shared",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(59, 89, 152, 0.75)",
              borderColor: "rgba(59, 89, 152, 1)",
              pointHoverBackgroundColor: "rgba(59, 89, 152, 1)",
              pointHoverBorderColor: "rgba(59, 89, 152, 1)",
              borderWidth: 5,
              data: ram_shared
            },
            {
              label: "RAM Available",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(184, 176, 15, 0.75)",
              borderColor: "rgba(184, 176, 15, 1)",
              pointHoverBackgroundColor: "rgba(184, 176, 15, 1)",
              pointHoverBorderColor: "rgba(184, 176, 15, 1)",
              borderWidth: 5,
              data: ram_available
            },
            {
              label: "RAM Buffered",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(184, 176, 15, 0.75)",
              borderColor: "rgba(184, 176, 15, 1)",
              pointHoverBackgroundColor: "rgba(184, 176, 15, 1)",
              pointHoverBorderColor: "rgba(184, 176, 15, 1)",
              borderWidth: 5,
              data: ram_buff
            },
            {
              label: "SWAP Used",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(184, 176, 15, 0.75)",
              borderColor: "rgba(184, 176, 15, 1)",
              pointHoverBackgroundColor: "rgba(184, 176, 15, 1)",
              pointHoverBorderColor: "rgba(184, 176, 15, 1)",
              borderWidth: 5,
              data: swap_used
            },
            {
              label: "SWAP Free",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(184, 176, 15, 0.75)",
              borderColor: "rgba(184, 176, 15, 1)",
              pointHoverBackgroundColor: "rgba(184, 176, 15, 1)",
              pointHoverBorderColor: "rgba(184, 176, 15, 1)",
              borderWidth: 5,
              data: swap_free
            },
            {
              label: "HDD Used",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(184, 176, 15, 0.75)",
              borderColor: "rgba(184, 176, 15, 1)",
              pointHoverBackgroundColor: "rgba(184, 176, 15, 1)",
              pointHoverBorderColor: "rgba(184, 176, 15, 1)",
              borderWidth: 5,
              data: used_hdd
            },
            {
              label: "HDD Free",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(184, 176, 15, 0.75)",
              borderColor: "rgba(184, 176, 15, 1)",
              pointHoverBackgroundColor: "rgba(184, 176, 15, 1)",
              pointHoverBorderColor: "rgba(184, 176, 15, 1)",
              borderWidth: 5,
              data: available_hdd
            },
            {
              label: "PID Running",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(184, 176, 15, 0.75)",
              borderColor: "rgba(184, 176, 15, 1)",
              pointHoverBackgroundColor: "rgba(184, 176, 15, 1)",
              pointHoverBorderColor: "rgba(184, 176, 15, 1)",
              borderWidth: 5,
              data: pid_running
            }
          ]
        };

        var cpudata = {
          labels: timesubmited,
          datasets: [{
            label: "CPU Percentage",
            fill: false,
            lineTension: 0.1,
            backgroundColor: "rgba(211, 72, 54, 0.75)",
            borderColor: "rgba(211, 72, 54, 1)",
            pointHoverBackgroundColor: "rgba(211, 72, 54, 1)",
            pointHoverBorderColor: "rgba(211, 72, 54, 1)",
            borderWidth: 5,
            data: cpu_percentage
          }]
        };

        var ramdata = {
          labels: timesubmited,
          datasets: [{
              label: "RAM Used",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(29, 202, 255, 0.75)",
              borderColor: "rgba(29, 202, 255, 1)",
              pointHoverBackgroundColor: "rgba(29, 202, 255, 1)",
              pointHoverBorderColor: "rgba(29, 202, 255, 1)",
              borderWidth: 5,
              data: ram_used
            },
            {
              label: "RAM Shared",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(59, 89, 152, 0.75)",
              borderColor: "rgba(59, 89, 152, 1)",
              pointHoverBackgroundColor: "rgba(59, 89, 152, 1)",
              pointHoverBorderColor: "rgba(59, 89, 152, 1)",
              borderWidth: 5,
              data: ram_shared
            },
            {
              label: "RAM Available",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(96, 75, 15, 0.75)",
              borderColor: "rgba(96, 75, 15, 1)",
              pointHoverBackgroundColor: "rgba(96, 75, 15, 1)",
              pointHoverBorderColor: "rgba(96, 75, 15, 1)",
              borderWidth: 5,
              data: ram_available
            },
            {
              label: "RAM Buffered",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(35, 176, 15, 0.75)",
              borderColor: "rgba(35, 176, 15, 1)",
              pointHoverBackgroundColor: "rgba(35, 176, 15, 1)",
              pointHoverBorderColor: "rgba(35, 176, 15, 1)",
              borderWidth: 5,
              data: ram_buff
            }
          ]
        };

        var swapdata = {
          labels: timesubmited,
          datasets: [{
              label: "SWAP Used",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(59, 89, 152, 0.75)",
              borderColor: "rgba(59, 89, 152, 1)",
              pointHoverBackgroundColor: "rgba(59, 89, 152, 1)",
              pointHoverBorderColor: "rgba(59, 89, 152, 1)",
              borderWidth: 5,
              data: swap_used
            },
            {
              label: "SWAP Free",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(96, 75, 15, 0.75)",
              borderColor: "rgba(96, 75, 15, 1)",
              pointHoverBackgroundColor: "rgba(96, 75, 15, 1)",
              pointHoverBorderColor: "rgba(96, 75, 15, 1)",
              borderWidth: 5,
              data: swap_free
            }
          ]
        };

        var hdddata = {
          labels: timesubmited,
          datasets: [{
              label: "HDD Used",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(59, 89, 152, 0.75)",
              borderColor: "rgba(59, 89, 152, 1)",
              pointHoverBackgroundColor: "rgba(59, 89, 152, 1)",
              pointHoverBorderColor: "rgba(59, 89, 152, 1)",
              borderWidth: 5,
              data: used_hdd
            },
            {
              label: "HDD Free",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(96, 75, 15, 0.75)",
              borderColor: "rgba(96, 75, 15, 1)",
              pointHoverBackgroundColor: "rgba(96, 75, 15, 1)",
              pointHoverBorderColor: "rgba(96, 75, 15, 1)",
              borderWidth: 5,
              data: available_hdd
            }
          ]
        };

        var piddata = {
          labels: timesubmited,
          datasets: [{
            label: "PIDs",
            fill: false,
            lineTension: 0.1,
            backgroundColor: "rgba(211, 72, 54, 0.75)",
            borderColor: "rgba(211, 72, 54, 1)",
            pointHoverBackgroundColor: "rgba(211, 72, 54, 1)",
            pointHoverBorderColor: "rgba(211, 72, 54, 1)",
            borderWidth: 5,
            data: pid_running
          }]
        };

        var cpu_ctx = $("#cpugraph");

        var ram_ctx = $("#ramgraph");
        var swap_ctx = $("#swapgraph");
        var hdd_ctx = $("#hddgraph");
        var pid_ctx = $("#pidgraph");

        var CpuGraph = new Chart(cpu_ctx, {
          type: 'line',
          data: cpudata,
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  min: 0,
                  max: 100,
                  callback: function(value) {
                    return value + "%"
                  }
                },
                scaleLabel: {
                  display: true,
                  labelString: "Percentage"
                }
              }]
            }
          }
        });

        var RamGraph = new Chart(ram_ctx, {
          type: 'line',
          data: ramdata,
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  stepSize: 1,
                  min: 0,
                  max: Math.max.apply(Math, ram_total),
                  callback: function(value) {
                    return value + "GB"
                  }
                },
                scaleLabel: {
                  display: true,
                  labelString: "Gigabytes"
                }
              }]
            }
          }
        });

        var SwapGraph = new Chart(swap_ctx, {
          type: 'line',
          data: swapdata,
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  stepSize: 1,
                  min: 0,
                  max: Math.max.apply(Math, swap_total),
                  callback: function(value) {
                    return value + "GB"
                  }
                },
                scaleLabel: {
                  display: true,
                  labelString: "Gigabytes"
                }
              }]
            }
          }
        });

        var HddGraph = new Chart(hdd_ctx, {
          type: 'line',
          data: hdddata,
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  stepSize: 50,
                  min: 0,
                  max: Math.max.apply(Math, total_hdd),
                  callback: function(value) {
                    return value + "GB"
                  }
                },
                scaleLabel: {
                  display: true,
                  labelString: "Gigabytes"
                }
              }]
            }
          }
        });

        var PidGraph = new Chart(pid_ctx, {
          type: 'line',
          data: piddata,
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  stepSize: 100,
                  min: 0,
                  max: Math.max.apply(Math, pid_running) + 200
                },
                scaleLabel: {
                  display: true,
                  labelString: "Running PIDs"
                }
              }]
            }
          }
        });
      } else {
        Utils.incorrect_auth();
      }
    }).fail(function(error) {
      console.log(error.responseJSON.error);
    });
  }
</script>

</html>
